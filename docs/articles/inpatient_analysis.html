<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Heart Failure Inpatient Analysis â€¢ hefd</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Heart Failure Inpatient Analysis">
<meta property="og:description" content="hefd">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hefd</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/inpatient_analysis.html">Heart Failure Inpatient Analysis</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="inpatient_analysis_files/header-attrs-2.10/header-attrs.js"></script><script src="inpatient_analysis_files/kePrint-0.0.1/kePrint.js"></script><link href="inpatient_analysis_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="inpatient_analysis_files/tabwid-1.0.0/tabwid.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Heart Failure Inpatient Analysis</h1>
                        <h4 class="author">Harrison Nguyen and Charmaine Tam</h4>
            
            <h4 class="date">10/11/2021</h4>
      
      
      <div class="hidden name"><code>inpatient_analysis.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/targets/">targets</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/">kableExtra</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/">ggpubr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://dusp.mit.edu/faculty/ezra-glenn">acs</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ardata-fr.github.io/flextable-book/">flextable</a></span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">hefd</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">proportion_bar_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>,<span class="va">column</span>,<span class="va">title</span>,<span class="va">n_suffix</span> <span class="op">=</span> <span class="cn">NULL</span>,<span class="va">vjust</span><span class="op">=</span><span class="op">-</span><span class="fl">0.25</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">n_suffix</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">title</span>, <span class="st">" (N = "</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span> 
  <span class="op">}</span>
  <span class="kw">else</span><span class="op">{</span>
    <span class="va">title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">title</span>, <span class="st">" (N = "</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, <span class="st">" "</span>,<span class="va">n_suffix</span>, <span class="st">")"</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="va">plot</span><span class="op">&lt;-</span> <span class="va">df</span> <span class="op">%&gt;%</span>
     <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="op">!</span><span class="op">!</span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/sym.html">sym</a></span><span class="op">(</span><span class="va">column</span><span class="op">)</span>,fill<span class="op">=</span><span class="op">!</span><span class="op">!</span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/sym.html">sym</a></span><span class="op">(</span><span class="va">column</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">..count..</span><span class="op">)</span>,stat<span class="op">=</span><span class="st">"count"</span>,alpha<span class="op">=</span><span class="fl">0.5</span>,show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="op">(</span><span class="va">..count..</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/pkg/acs/man/sum-methods.html">sum</a></span><span class="op">(</span><span class="va">..count..</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span>,<span class="fl">0</span><span class="op">)</span>,<span class="st">"%"</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,y<span class="op">=</span> <span class="va">..count..</span><span class="op">)</span>,
       stat<span class="op">=</span><span class="st">'count'</span>,
       vjust<span class="op">=</span><span class="va">vjust</span>
   <span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span>
  
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">conditional_bar_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>,<span class="va">var1</span>,<span class="va">var2</span>,<span class="va">title</span>,<span class="va">n_suffix</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">n_suffix</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">title</span>, <span class="st">" (N = "</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span> 
  <span class="op">}</span>
  <span class="kw">else</span><span class="op">{</span>
    <span class="va">title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">title</span>, <span class="st">" (N = "</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, <span class="st">" "</span>,<span class="va">n_suffix</span>, <span class="st">")"</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="va">var1</span><span class="op">&lt;-</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/sym.html">sym</a></span><span class="op">(</span><span class="va">var1</span><span class="op">)</span>
  <span class="va">var2</span><span class="op">&lt;-</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/sym.html">sym</a></span><span class="op">(</span><span class="va">var2</span><span class="op">)</span>
  <span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">var1</span>,<span class="op">!</span><span class="op">!</span><span class="va">var2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">var1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/prop.table.html">prop.table</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="op">!</span><span class="op">!</span><span class="va">var1</span>,y<span class="op">=</span><span class="va">n</span>,fill<span class="op">=</span><span class="op">!</span><span class="op">!</span><span class="va">var2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>,position<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span><span class="fl">0.7</span><span class="op">)</span>,width<span class="op">=</span><span class="fl">0.7</span>,alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">prop</span>,<span class="fl">0</span><span class="op">)</span>,<span class="st">"%"</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,y<span class="op">=</span><span class="va">n</span><span class="op">)</span>,position<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span><span class="fl">0.7</span><span class="op">)</span>,vjust<span class="op">=</span><span class="op">-</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y<span class="op">=</span><span class="st">"Count"</span>,x<span class="op">=</span><span class="va">var1</span>, title <span class="op">=</span> <span class="va">title</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html">scale_fill_discrete</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">var2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">plot_histogram</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>,<span class="va">column</span>, <span class="va">title</span>,<span class="va">threshold</span> <span class="op">=</span> <span class="cn">NULL</span>,<span class="va">n_suffix</span><span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">n_suffix</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">title</span>, <span class="st">" (N = "</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span> 
  <span class="op">}</span>
  <span class="kw">else</span><span class="op">{</span>
    <span class="va">title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">title</span>, <span class="st">" (N = "</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, <span class="st">" "</span>,<span class="va">n_suffix</span>, <span class="st">")"</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="va">var1</span><span class="op">&lt;-</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/sym.html">sym</a></span><span class="op">(</span><span class="va">column</span><span class="op">)</span>

  <span class="va">df</span> <span class="op">%&lt;&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">var1</span><span class="op">)</span><span class="op">)</span>
  
  
  <span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="op">!</span><span class="op">!</span><span class="va">var1</span>,fill<span class="op">=</span><span class="op">!</span><span class="op">!</span><span class="va">var1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"lightblue"</span>,alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y<span class="op">=</span><span class="st">"Count"</span>,x<span class="op">=</span><span class="va">var1</span>, title <span class="op">=</span> <span class="va">title</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_pretty.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">stat_bin</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">..count..</span>, label<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">..count..</span><span class="op">==</span><span class="fl">0</span>,<span class="st">""</span>,<span class="va">..count..</span><span class="op">)</span><span class="op">)</span>, geom<span class="op">=</span><span class="st">"text"</span>, vjust<span class="op">=</span><span class="op">-</span><span class="fl">.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span>
    

  
  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">threshold</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xintercept<span class="op">=</span><span class="va">threshold</span><span class="op">)</span>,
            color<span class="op">=</span><span class="st">"red"</span>, linetype<span class="op">=</span><span class="st">"dashed"</span>, size<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">plot_histogram_group</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>,<span class="va">var1</span>,<span class="va">var2</span>,<span class="va">title</span>,<span class="va">n_suffix</span><span class="op">)</span><span class="op">{</span>
  
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">n_suffix</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">title</span>, <span class="st">" (N = "</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span> 
  <span class="op">}</span>
  <span class="kw">else</span><span class="op">{</span>
    <span class="va">title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">title</span>, <span class="st">" (N = "</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, <span class="st">" "</span>,<span class="va">n_suffix</span>, <span class="st">")"</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="va">var1</span><span class="op">&lt;-</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/sym.html">sym</a></span><span class="op">(</span><span class="va">var1</span><span class="op">)</span>
  <span class="va">var2</span><span class="op">&lt;-</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/sym.html">sym</a></span><span class="op">(</span><span class="va">var2</span><span class="op">)</span>

  <span class="va">df</span> <span class="op">%&lt;&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">var1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">var2</span><span class="op">)</span><span class="op">)</span>
  
  
  <span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="op">!</span><span class="op">!</span><span class="va">var1</span>,fill<span class="op">=</span><span class="op">!</span><span class="op">!</span><span class="va">var2</span>,color<span class="op">=</span><span class="op">!</span><span class="op">!</span><span class="va">var2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">..density..</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.5</span>, position<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y<span class="op">=</span><span class="st">"Count"</span>,x<span class="op">=</span><span class="va">var1</span>, title <span class="op">=</span> <span class="va">title</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_pretty.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span>
    
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">plot_logical_columns</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>,<span class="va">var1</span>,<span class="va">title</span>,<span class="va">n_suffix</span><span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">n_suffix</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">title</span>, <span class="st">" (N = "</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span> 
  <span class="op">}</span>
  <span class="kw">else</span><span class="op">{</span>
    <span class="va">title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">title</span>, <span class="st">" (N = "</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, <span class="st">" "</span>,<span class="va">n_suffix</span>, <span class="st">")"</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="va">var1</span><span class="op">&lt;-</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/sym.html">sym</a></span><span class="op">(</span><span class="va">var1</span><span class="op">)</span>
  
  <span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">%&gt;%</span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_if</a></span><span class="op">(</span><span class="va">is.logical</span>,<span class="va">sum</span><span class="op">)</span> <span class="op">%&gt;%</span>
   <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>,values_to <span class="op">=</span> <span class="st">"N"</span>,names_to <span class="op">=</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/as_string.html">as_string</a></span><span class="op">(</span><span class="va">var1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="va">N</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span>

  <span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">plot_data</span> <span class="op">%&gt;%</span>
       <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="op">!</span><span class="op">!</span><span class="va">var1</span>,y<span class="op">=</span><span class="va">N</span>,fill<span class="op">=</span><span class="op">!</span><span class="op">!</span><span class="va">var1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>position<span class="op">=</span><span class="st">"dodge"</span>, stat<span class="op">=</span><span class="st">"identity"</span>,show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">prop</span>,<span class="fl">0</span><span class="op">)</span>,<span class="st">"%"</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,y<span class="op">=</span><span class="va">N</span><span class="op">)</span>,vjust<span class="op">=</span><span class="op">-</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y<span class="op">=</span><span class="st">"Count"</span>,x<span class="op">=</span><span class="va">var1</span>, title <span class="op">=</span> <span class="va">title</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_pie_chart</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>,<span class="va">var1</span>,<span class="va">title</span>,<span class="va">n_suffix</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">n_suffix</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">title</span>, <span class="st">" (N = "</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span> 
  <span class="op">}</span>
  <span class="kw">else</span><span class="op">{</span>
    <span class="va">title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">title</span>, <span class="st">" (N = "</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, <span class="st">" "</span>,<span class="va">n_suffix</span>, <span class="st">")"</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="va">var1</span><span class="op">&lt;-</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/sym.html">sym</a></span><span class="op">(</span><span class="va">var1</span><span class="op">)</span>
  <span class="va">df</span> <span class="op">%&lt;&gt;%</span> 
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">var1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">var1</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># Variable to be transformed</span>
    <span class="fu">count</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>perc <span class="op">=</span> <span class="va">`n`</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/pkg/acs/man/sum-methods.html">sum</a></span><span class="op">(</span><span class="va">`n`</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">arrange</span><span class="op">(</span><span class="va">perc</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_percent.html">percent</a></span><span class="op">(</span><span class="va">perc</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="va">n</span>, fill <span class="op">=</span> <span class="op">!</span><span class="op">!</span><span class="va">var1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">labels</span><span class="op">)</span>,
              position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_stack.html">position_stack</a></span><span class="op">(</span>vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_polar.html">coord_polar</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y<span class="op">=</span><span class="st">"Count"</span>,x<span class="op">=</span><span class="va">var1</span>, title <span class="op">=</span> <span class="va">title</span><span class="op">)</span>
    
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">encounter_ref</span> <span class="op">&lt;-</span> <span class="fu">load_data</span><span class="op">(</span><span class="st">"encounter_reference"</span><span class="op">)</span>
<span class="va">encounter</span> <span class="op">&lt;-</span> <span class="fu">load_data</span><span class="op">(</span><span class="st">"encounter"</span><span class="op">)</span>
<span class="va">diagnosis</span> <span class="op">&lt;-</span> <span class="fu">load_data</span><span class="op">(</span><span class="st">"diagnosis"</span><span class="op">)</span>
<span class="va">diagnosis_history</span> <span class="op">&lt;-</span> <span class="fu">load_data</span><span class="op">(</span><span class="st">"diagnosis_history"</span><span class="op">)</span>
<span class="va">problem</span> <span class="op">&lt;-</span> <span class="fu">load_data</span><span class="op">(</span><span class="st">"problem"</span><span class="op">)</span>
<span class="va">orders</span> <span class="op">&lt;-</span> <span class="fu">load_data</span><span class="op">(</span><span class="st">"orders"</span><span class="op">)</span>
<span class="va">patient</span> <span class="op">&lt;-</span> <span class="fu">load_data</span><span class="op">(</span><span class="st">"patient"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">query</span> <span class="op">&lt;-</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"SELECT * from MEDICATION_ORDERS as x \\
            WHERE ENCNTR_ID in (SELECT PX9_ENCNTR_ID from ENCOUNTER_REFERENCE \\
             WHERE Q4_DIAGNOSIS = 1 and PROCESS_FLAG = 1 and HISTORY_FLAG = 0) and (ORIG_ORD_AS_FLAG = 1 OR ORIG_ORD_AS_FLAG=2)"</span><span class="op">)</span>
<span class="va">medication_order</span> <span class="op">&lt;-</span> <span class="fu">execute_query</span><span class="op">(</span><span class="va">query</span><span class="op">)</span>

<span class="va">hf_form</span> <span class="op">&lt;-</span> <span class="fu">execute_query</span><span class="op">(</span><span class="st">"SELECT * from DCP_FORMS_ACTIVITY where DESCRIPTION = 'Heart Failure (MACARF) Referral Form' or DESCRIPTION = 'Heart Failure - Management of Cardiac Function Enrolment'"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">location_string</span> <span class="op">&lt;-</span> <span class="st">"Royal North Shore"</span>
<span class="va">hf_diag</span> <span class="op">&lt;-</span> <span class="va">diagnosis</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">SOURCE_IDENTIFIER</span>,<span class="st">"(?i)I50"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">DIAG_TYPE_CD</span> <span class="op">==</span> <span class="st">"Final"</span><span class="op">)</span>

<span class="va">qual_enc</span> <span class="op">&lt;-</span> <span class="va">encounter</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ENCNTR_ID</span> <span class="op">%in%</span> <span class="va">hf_diag</span><span class="op">$</span><span class="va">ENCNTR_ID</span> <span class="op">&amp;</span> <span class="va">LOC_FACILITY_CD</span> <span class="op">==</span> <span class="va">location_string</span><span class="op">)</span>

<span class="va">cohort</span> <span class="op">&lt;-</span> <span class="va">qual_enc</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">PERSON_ID</span><span class="op">)</span>

<span class="va">time_period</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">qual_enc</span><span class="op">$</span><span class="va">DISCH_DT_TM</span>,na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">qual_enc</span><span class="op">$</span><span class="va">DISCH_DT_TM</span>,na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,units<span class="op">=</span><span class="st">"days"</span><span class="op">)</span><span class="op">/</span><span class="fl">362.2425</span>,<span class="fl">1</span><span class="op">)</span></code></pre></div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This document will investigate encounters that have been coded with a heart failure-related ICD10 code (I50; primary or secondary) at <strong>Royal North Shore</strong> Hospital with discharge dates between <strong>2019-01-01</strong> to <strong>2021-07-31</strong>. Thus, in a <strong>2.6</strong> year period, there are <strong>3538</strong> encounters with unique <strong>2654</strong> patients. Figure @ref(fig:dist-enc-plot) shows the distribution of the number of encounters for each patient and Figure @ref(fig:encntr-type-plot) shows the distribution of encounters type where the majority of encounters are <strong>inpatient</strong> encounters.</p>
<p>The analysis of this cohort will be used to examine:</p>
<ol style="list-style-type: decimal">
<li>Demographics and characteristics</li>
</ol>
<ul>
<li>Total admissions by facility</li>
<li>Age and sex distributions</li>
<li>Numbers of patient journeys and transfers across the District</li>
<li>Mode of admission and mode of separation</li>
<li>Number of patients with Advanced Care Directive</li>
<li>Previous hospitalisation in the past 3 years (for HF or other?, primary or additional diagnoses?)</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Investigations</li>
</ol>
<ul>
<li>Number of patients with at least 1 echocardiogram performed</li>
<li>BNP and Iron profiles</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Discharge management</li>
</ol>
<ul>
<li>Number of patients with discharge letters</li>
<li>Number of patients on relevant discharge medications or none</li>
<li>Number of patients that are referred to the HF service</li>
</ul>
<p>This feasibility analyses will be initially be performed for encounters at RNSH, then Ryde and Hornsby, and then patients that transfer between NSLHD facilities.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">counts</span> <span class="op">&lt;-</span> <span class="va">qual_enc</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">PERSON_ID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="fu">proportion_bar_plot</span><span class="op">(</span><span class="va">counts</span>,<span class="st">"N"</span>, <span class="st">"Number of encounters per patient"</span>,n_suffix<span class="op">=</span><span class="st">"patients"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/dist-enc-plot-1.png" alt="Distribution of the number of encounters for each patient." width="700"><p class="caption">
Distribution of the number of encounters for each patient.
</p>
</div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">proportion_bar_plot</span><span class="op">(</span><span class="va">qual_enc</span>,<span class="st">"ENCNTR_TYPE_CD"</span>,<span class="st">"Distribution of Encounter Type"</span>,n_suffix <span class="op">=</span> <span class="st">"encounters"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/encntr-type-plot-1.png" alt="Distribution of Encounter Type." width="700"><p class="caption">
Distribution of Encounter Type.
</p>
</div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">extract_hf_diagnosis</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>,<span class="va">group_cols</span> <span class="op">=</span> <span class="st">"ENCNTR_ID"</span><span class="op">)</span><span class="op">{</span>
  
  <span class="va">group_cols</span> <span class="op">&lt;-</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/sym.html">sym</a></span><span class="op">(</span><span class="va">group_cols</span><span class="op">)</span>
  <span class="va">df</span> <span class="op">%&lt;&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">group_cols</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>
    `Congestive heart failure` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">SOURCE_IDENTIFIER</span> <span class="op">==</span> <span class="st">"I50.0"</span> <span class="op">|</span> <span class="va">SOURCE_IDENTIFIER</span> <span class="op">==</span> <span class="st">"I50"</span><span class="op">)</span>,
    `Heart failure, unspecified` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">SOURCE_IDENTIFIER</span> <span class="op">==</span> <span class="st">"I50.9"</span><span class="op">)</span>,
    `Left ventricular failure` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">SOURCE_IDENTIFIER</span> <span class="op">==</span> <span class="st">"I50.1"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="cn">FALSE</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div id="cohort-stratification---primary-secondary-heart-failure-diagnosis" class="section level2">
<h2 class="hasAnchor">
<a href="#cohort-stratification---primary-secondary-heart-failure-diagnosis" class="anchor"></a>Cohort Stratification - Primary &amp; Secondary Heart Failure Diagnosis</h2>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hf_diag_primary</span> <span class="op">&lt;-</span> <span class="va">hf_diag</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">DIAG_PRIORITY</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">ENCNTR_ID</span> <span class="op">%in%</span> <span class="va">qual_enc</span><span class="op">$</span><span class="va">ENCNTR_ID</span><span class="op">)</span>
  
<span class="va">hf_diag_secondary</span> <span class="op">&lt;-</span> <span class="va">hf_diag</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">DIAG_PRIORITY</span> <span class="op">!=</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">ENCNTR_ID</span> <span class="op">%in%</span> <span class="va">qual_enc</span><span class="op">$</span><span class="va">ENCNTR_ID</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">primary_temp</span> <span class="op">&lt;-</span> <span class="va">hf_diag_primary</span> <span class="op">%&gt;%</span>
  <span class="fu">extract_hf_diagnosis</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>`Primary HF Diagnosis` <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">secondary_temp</span> <span class="op">&lt;-</span> <span class="va">hf_diag_secondary</span> <span class="op">%&gt;%</span>
  <span class="fu">extract_hf_diagnosis</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>`Secondary HF Diagnosis` <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">combined_temp</span> <span class="op">&lt;-</span> <span class="va">hf_diag</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ENCNTR_ID</span> <span class="op">%in%</span> <span class="va">qual_enc</span><span class="op">$</span><span class="va">ENCNTR_ID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">extract_hf_diagnosis</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>`Prim. &amp; Sec. HF Diagnosis` <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hf_diag_primary_count</span> <span class="op">&lt;-</span> <span class="va">hf_diag_primary</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ENCNTR_ID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">N</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">hf_diag_secondary_count</span> <span class="op">&lt;-</span> <span class="va">hf_diag_secondary</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ENCNTR_ID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">N</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>Figure @ref(fig:icd10-dist-plot) shows the distribution of primary and secondary heart failure ICD10 codes. In some cases, there are encounters with multiple heart failure primary diagnoses, (n = <strong>59</strong>) and similarly with secondary diagnosis (n = <strong>233</strong>).</p>
<p>For the given diagnosis, <strong>congestive heart failure</strong> is most prevalent, followed by <strong>left ventricular failure</strong> then <strong>heart failure, unspecified</strong>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">plot_logical_columns</span><span class="op">(</span><span class="va">primary_temp</span>,<span class="st">"ICD10"</span>,<span class="st">"Primary HF ICD10"</span>,n_suffix<span class="op">=</span><span class="st">"encounters"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_axis.html">guide_axis</a></span><span class="op">(</span>n.dodge<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2000</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">plot_logical_columns</span><span class="op">(</span><span class="va">secondary_temp</span>,<span class="st">"ICD10"</span>,<span class="st">"Secondary HF ICD10"</span>,n_suffix<span class="op">=</span><span class="st">"encounters"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_axis.html">guide_axis</a></span><span class="op">(</span>n.dodge<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3500</span><span class="op">)</span>

<span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu">plot_logical_columns</span><span class="op">(</span><span class="va">combined_temp</span>,<span class="st">"ICD10"</span>,<span class="st">"Combined Primary &amp; Secondary HF ICD10"</span>,n_suffix<span class="op">=</span><span class="st">"encounters"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_axis.html">guide_axis</a></span><span class="op">(</span>n.dodge<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5000</span><span class="op">)</span>

<span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">p1</span>,<span class="va">p2</span>,<span class="va">p3</span>,labels<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/icd10-dist-plot-1.png" alt="Distribution of primary and secondary ICD10 diagnosis." width="700"><p class="caption">
Distribution of primary and secondary ICD10 diagnosis.
</p>
</div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">prim_sec_merge</span> <span class="op">&lt;-</span> <span class="va">primary_temp</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">secondary_temp</span>,by<span class="op">=</span><span class="st">"ENCNTR_ID"</span>,suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"_PRIMARY"</span>,<span class="st">"_SECONDARY"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>PRIMARY_DIAG <span class="op">=</span> 
                  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>
                    <span class="va">`Congestive heart failure_PRIMARY`</span> <span class="op">~</span> <span class="st">"Congestive heart failure"</span>,
                    <span class="va">`Left ventricular failure_PRIMARY`</span> <span class="op">~</span> <span class="st">"Left ventricular failure"</span>,
                    <span class="va">`Heart failure, unspecified_PRIMARY`</span> <span class="op">~</span> <span class="st">"Heart failure, unspecified"</span>,
                  <span class="op">)</span>,
                SECONDARY_DIAG <span class="op">=</span> 
                  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>
                    <span class="va">`Congestive heart failure_SECONDARY`</span> <span class="op">~</span> <span class="st">"Congestive heart failure"</span>,
                    <span class="va">`Left ventricular failure_SECONDARY`</span> <span class="op">~</span> <span class="st">"Left ventricular failure"</span>,
                    <span class="va">`Heart failure, unspecified_SECONDARY`</span> <span class="op">~</span> <span class="st">"Heart failure, unspecified"</span>,
                  <span class="op">)</span>
                <span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diag_tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/prop.table.html">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">prim_sec_merge</span><span class="op">$</span><span class="va">PRIMARY_DIAG</span>,<span class="va">prim_sec_merge</span><span class="op">$</span><span class="va">SECONDARY_DIAG</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>An encounter can also be associated with both a primary and secondary heart failure ICD10, where <strong>2.3</strong>% (<strong>82</strong>/<strong>3538</strong>) of encounters have both a primary and secondary heart failure ICD10 diagnosis . Table @ref(tab:primary-sec-hf-diag) shows the encounters with both a primary and secondary HF diagnosis (n = <strong>82</strong>) and the proportion of this selection with different combinations of primary and secondary diagnosis. For example, <strong>80.5</strong>% of these encounters have both a primary and secondary diagnosis of <strong>congestive heart failure</strong>. This is explained by coding occurring at the episode level and encounters may have &gt;1 episode.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tab_caption</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Contingency table of Primary and Secondary HF Diagnosis (N = "</span>,
                      <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">prim_sec_merge</span><span class="op">)</span>,<span class="st">"/"</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">combined_temp</span><span class="op">)</span>,<span class="st">")"</span><span class="op">)</span>
<span class="va">diag_tab</span> <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="va">tab_caption</span>,digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/add_header_above.html">add_header_above</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Primary ICD10"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"Secondary ICD10"</span><span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"center"</span>,full_width <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<table class="table table">
<caption>
Contingency table of Primary and Secondary HF Diagnosis (N = 82/3538)
</caption>
<thead>
<tr>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="1">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Primary ICD10
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Secondary ICD10
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Congestive heart failure
</th>
<th style="text-align:right;">
Heart failure, unspecified
</th>
<th style="text-align:right;">
Left ventricular failure
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Congestive heart failure
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
0.01
</td>
</tr>
<tr>
<td style="text-align:left;">
Heart failure, unspecified
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
Left ventricular failure
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
0.10
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">only_secondary</span> <span class="op">&lt;-</span> <span class="va">secondary_temp</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">ENCNTR_ID</span> <span class="op">%in%</span> <span class="va">primary_temp</span><span class="op">$</span><span class="va">ENCNTR_ID</span><span class="op">)</span>
<span class="va">n_only_prim</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">only_secondary</span><span class="op">)</span></code></pre></div>
<p>Table @ref(tab:prim-sec-tab) shows the primary diagnosis of those encounters with <strong>ONLY</strong> secondary heart failure diagnosis (n = <strong>2290</strong>). The data shows that these encounters are also commonly associated with <strong>pneumonia</strong>, as well as some other heart related issue such as <strong>atrial fibrillation</strong> or a <strong>myocardial infarction</strong>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">primary_diag_of_secondary</span> <span class="op">&lt;-</span> <span class="va">diagnosis</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">SOURCE_IDENTIFIER</span>,<span class="st">"(?i)I50"</span><span class="op">)</span> <span class="op">&amp;</span> 
                  <span class="va">ENCNTR_ID</span> <span class="op">%in%</span> <span class="va">only_secondary</span><span class="op">$</span><span class="va">ENCNTR_ID</span> <span class="op">&amp;</span>
                  <span class="va">DIAG_PRIORITY</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span>
                  <span class="va">SOURCE_VOCABULARY_CD</span> <span class="op">==</span> <span class="st">"ICD10-AM"</span><span class="op">)</span> 

<span class="va">tab_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span>
  <span class="st">"Top 15 primary diagnosis for those with only a secondary heart failure diagnosis (N ="</span>,
  <span class="va">n_only_prim</span>,
  <span class="st">"encounters)."</span>,
  sep<span class="op">=</span><span class="st">" "</span>
<span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">primary_diag_of_secondary</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">SOURCE_STRING</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">ENCNTR_ID</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">N</span><span class="op">/</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">primary_diag_of_secondary</span><span class="op">$</span><span class="va">PERSON_ID</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/top_n.html">top_n</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="va">tab_cap</span><span class="op">)</span></code></pre></div>
<table class="table">
<caption>
Top 15 primary diagnosis for those with only a secondary heart failure diagnosis (N = 2290 encounters).
</caption>
<thead><tr>
<th style="text-align:left;">
SOURCE_STRING
</th>
<th style="text-align:right;">
N
</th>
<th style="text-align:right;">
prop
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Pneumonia, unspecified
</td>
<td style="text-align:right;">
145
</td>
<td style="text-align:right;">
7.3
</td>
</tr>
<tr>
<td style="text-align:left;">
Atrial fibrillation and atrial flutter, unspecified
</td>
<td style="text-align:right;">
138
</td>
<td style="text-align:right;">
7.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Acute subendocardial myocardial infarction
</td>
<td style="text-align:right;">
117
</td>
<td style="text-align:right;">
5.9
</td>
</tr>
<tr>
<td style="text-align:left;">
Person awaiting admission to rehabilitation facility/unit
</td>
<td style="text-align:right;">
74
</td>
<td style="text-align:right;">
3.7
</td>
</tr>
<tr>
<td style="text-align:left;">
Person awaiting admission to residential aged care service
</td>
<td style="text-align:right;">
73
</td>
<td style="text-align:right;">
3.7
</td>
</tr>
<tr>
<td style="text-align:left;">
Aortic (valve) stenosis
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
3.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Cellulitis of lower limb
</td>
<td style="text-align:right;">
49
</td>
<td style="text-align:right;">
2.5
</td>
</tr>
<tr>
<td style="text-align:left;">
Acute transmural myocardial infarction of anterior wall
</td>
<td style="text-align:right;">
48
</td>
<td style="text-align:right;">
2.4
</td>
</tr>
<tr>
<td style="text-align:left;">
Chronic obstructive pulmonary disease with acute lower respiratory infection
</td>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
2.4
</td>
</tr>
<tr>
<td style="text-align:left;">
Atherosclerotic heart disease, of native coronary artery
</td>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
2.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Sepsis, unspecified
</td>
<td style="text-align:right;">
41
</td>
<td style="text-align:right;">
2.1
</td>
</tr>
<tr>
<td style="text-align:left;">
Acute kidney failure, unspecified
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
1.8
</td>
</tr>
<tr>
<td style="text-align:left;">
Dyspnoea
</td>
<td style="text-align:right;">
31
</td>
<td style="text-align:right;">
1.6
</td>
</tr>
<tr>
<td style="text-align:left;">
Pneumonitis due to food and vomit
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
1.5
</td>
</tr>
<tr>
<td style="text-align:left;">
Person awaiting admission to other health care facility
</td>
<td style="text-align:right;">
27
</td>
<td style="text-align:right;">
1.4
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">primary_cohort</span> <span class="op">&lt;-</span> <span class="va">cohort</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">PERSON_ID</span> <span class="op">%in%</span> <span class="va">hf_diag_primary</span><span class="op">$</span><span class="va">PERSON_ID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>HAS_PRIMARY_HF <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>


<span class="va">AGE_breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>,<span class="fl">18</span>, <span class="fl">25</span>, <span class="fl">45</span>, <span class="fl">65</span>, <span class="fl">80</span>, <span class="cn">Inf</span><span class="op">)</span>
  <span class="va">AGE_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;18"</span>, <span class="st">"19-24"</span>, <span class="st">"25-44"</span>, <span class="st">"45-64"</span>, <span class="st">"65-80"</span>, <span class="st">"80+"</span><span class="op">)</span>
  
<span class="va">primary_enc</span> <span class="op">&lt;-</span> <span class="va">encounter</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ENCNTR_ID</span> <span class="op">%in%</span> <span class="va">hf_diag_primary</span><span class="op">$</span><span class="va">ENCNTR_ID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">patient</span>, by <span class="op">=</span> <span class="st">"PERSON_ID"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>AGE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span><span class="op">(</span><span class="va">ACTIVE_STATUS_DT_TM</span>,<span class="va">BIRTH_DT_TM</span>, units<span class="op">=</span><span class="st">"weeks"</span><span class="op">)</span><span class="op">/</span><span class="fl">52.25</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>AGE_BINNED <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">AGE</span>, breaks <span class="op">=</span> <span class="va">AGE_breaks</span>, labels <span class="op">=</span> <span class="va">AGE_labels</span>,
                                   right <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>LOS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span><span class="op">(</span><span class="va">DISCH_DT_TM</span>,<span class="va">ARRIVE_DT_TM</span>,units<span class="op">=</span><span class="st">"days"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">primary_temp</span>, by<span class="op">=</span><span class="st">"ENCNTR_ID"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>PRIMARY_DIAG <span class="op">=</span> 
                  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>
                    <span class="va">`Congestive heart failure`</span> <span class="op">~</span> <span class="st">"Congestive heart failure"</span>,
                    <span class="va">`Left ventricular failure`</span> <span class="op">~</span> <span class="st">"Left ventricular failure"</span>,
                    <span class="va">`Heart failure, unspecified`</span> <span class="op">~</span> <span class="st">"Heart failure, unspecified"</span>,
                  <span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The cohort that will be analysed for the rest of this document are those encounters with a primary heart failure diagnosis.</p>
</div>
</div>
<div id="demographics-in-patients-with-encounters-containing-a-primary-hf-icd10-code" class="section level1">
<h1 class="hasAnchor">
<a href="#demographics-in-patients-with-encounters-containing-a-primary-hf-icd10-code" class="anchor"></a>Demographics in patients with encounters containing a primary HF ICD10 code</h1>
<p>With these selection and exclusion criteria, the cohort for this analysis will include <strong>1248</strong> number of encounters for <strong>952</strong> unique patients with the following demographics.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">primary_demo</span> <span class="op">&lt;-</span> <span class="va">primary_enc</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">PERSON_ID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">AGE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">total</span><span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">primary_demo</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">primary_demo</span>, SEX_CD <span class="op">=</span> <span class="st">"Total"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">SEX_CD</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>
    N <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,
    Age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">AGE</span><span class="op">)</span><span class="op">)</span>,
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"SEX_CD"</span>, values_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"N"</span>, <span class="st">"Age"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>p_Female <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">N_Female</span><span class="op">/</span><span class="va">N_Total</span><span class="op">*</span><span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>,
         p_Male <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">N_Male</span><span class="op">/</span><span class="va">N_Total</span><span class="op">*</span><span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span>
         Females <span class="op">=</span> <span class="va">N_Female</span>, <span class="va">p_Female</span>,
         Males <span class="op">=</span> <span class="va">N_Male</span>, <span class="va">p_Male</span>,
         <span class="va">N_Total</span>,
         <span class="va">Age_Female</span>,
         <span class="va">Age_Male</span>,
         <span class="va">Age_Total</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/flextable.html">flextable</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/set_header_labels.html">set_header_labels</a></span><span class="op">(</span>Group <span class="op">=</span> <span class="st">""</span>, p_Female <span class="op">=</span> <span class="st">"%"</span>, p_Male <span class="op">=</span> <span class="st">"%"</span>, N_Total <span class="op">=</span> <span class="st">"n"</span>,
                    Age_Female <span class="op">=</span> <span class="st">"Age (F)"</span>, Age_Male <span class="op">=</span> <span class="st">"Age (M)"</span>, Age_Total <span class="op">=</span> <span class="st">"Mean Age"</span><span class="op">)</span>
<span class="va">total</span></code></pre></div>
<template id="b2e14e61-c5dd-4b9a-8020-95a3da48c264"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style>
<div class="tabwid">
<style>.cl-2e35262e{}.cl-2e28a2d2{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-2e28c9ec{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-2e29180c{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2e29180d{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table class="table cl-2e35262e">
<thead><tr style="overflow-wrap:break-word;">
<td class="cl-2e29180d"><p class="cl-2e28c9ec"><span class="cl-2e28a2d2">Females</span></p></td>
<td class="cl-2e29180d"><p class="cl-2e28c9ec"><span class="cl-2e28a2d2">%</span></p></td>
<td class="cl-2e29180d"><p class="cl-2e28c9ec"><span class="cl-2e28a2d2">Males</span></p></td>
<td class="cl-2e29180d"><p class="cl-2e28c9ec"><span class="cl-2e28a2d2">%</span></p></td>
<td class="cl-2e29180d"><p class="cl-2e28c9ec"><span class="cl-2e28a2d2">n</span></p></td>
<td class="cl-2e29180d"><p class="cl-2e28c9ec"><span class="cl-2e28a2d2">Age (F)</span></p></td>
<td class="cl-2e29180d"><p class="cl-2e28c9ec"><span class="cl-2e28a2d2">Age (M)</span></p></td>
<td class="cl-2e29180d"><p class="cl-2e28c9ec"><span class="cl-2e28a2d2">Mean Age</span></p></td>
</tr></thead>
<tbody><tr style="overflow-wrap:break-word;">
<td class="cl-2e29180c"><p class="cl-2e28c9ec"><span class="cl-2e28a2d2">444</span></p></td>
<td class="cl-2e29180c"><p class="cl-2e28c9ec"><span class="cl-2e28a2d2">46.6</span></p></td>
<td class="cl-2e29180c"><p class="cl-2e28c9ec"><span class="cl-2e28a2d2">508</span></p></td>
<td class="cl-2e29180c"><p class="cl-2e28c9ec"><span class="cl-2e28a2d2">53.4</span></p></td>
<td class="cl-2e29180c"><p class="cl-2e28c9ec"><span class="cl-2e28a2d2">952</span></p></td>
<td class="cl-2e29180c"><p class="cl-2e28c9ec"><span class="cl-2e28a2d2">83</span></p></td>
<td class="cl-2e29180c"><p class="cl-2e28c9ec"><span class="cl-2e28a2d2">80</span></p></td>
<td class="cl-2e29180c"><p class="cl-2e28c9ec"><span class="cl-2e28a2d2">81</span></p></td>
</tr></tbody>
</table>
</div></template><div class="flextable-shadow-host" id="9af6deed-60bd-4ee7-b2ef-e0a62f553b9b"></div>
<script>
var dest = document.getElementById("9af6deed-60bd-4ee7-b2ef-e0a62f553b9b");
var template = document.getElementById("b2e14e61-c5dd-4b9a-8020-95a3da48c264");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script><p>Figure @ref(fig:age-sex-plot) shows the distribution of sex according to age groups.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">conditional_bar_plot</span><span class="op">(</span><span class="va">primary_demo</span>,<span class="st">"AGE_BINNED"</span>,<span class="st">"SEX_CD"</span>, <span class="st">"Age and Sex"</span>,n_suffix<span class="op">=</span><span class="st">"patients"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html">scale_fill_discrete</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"SEX"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"AGE"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/age-sex-plot-1.png" alt="Distribution of Sex conditioned on Age." width="700"><p class="caption">
Distribution of Sex conditioned on Age.
</p>
</div>
<p>Figure @ref(fig:admit-disch-mode-plot) shows the distribution of admission and discharges modes for these encounters with a primary HF diagnosis. Arrival by <strong>State Ambulance Vehicle</strong> is the most prevalent mode of admission followed by <strong>Private Car</strong> then <strong>No transport</strong>. On the other hand, the top 3 discharge modes were, <strong>Discharge by hospital</strong>, followed by <strong>Transfer to Hospital in area/region</strong> then <strong>Pt death without autopsy</strong>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">proportion_bar_plot</span><span class="op">(</span><span class="va">primary_enc</span>,<span class="st">"ADMIT_MODE_CD"</span>,<span class="st">"Mode of Admission"</span>,n_suffix<span class="op">=</span><span class="st">"encounters"</span>,vjust<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">800</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">proportion_bar_plot</span><span class="op">(</span><span class="va">primary_enc</span>,<span class="st">"DISCH_DISPOSITION_CD"</span>,<span class="st">"Mode of Separation"</span>,n_suffix<span class="op">=</span><span class="st">"encounters"</span>,vjust<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1100</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span>


<span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">p1</span>,<span class="va">p2</span>,nrow<span class="op">=</span><span class="fl">2</span>,ncol <span class="op">=</span> <span class="fl">1</span>, labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>,<span class="st">"B"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/admit-disch-mode-plot-1.png" alt="Admission and Discharge mode of encounters with primary HF diagnosis." width="700"><p class="caption">
Admission and Discharge mode of encounters with primary HF diagnosis.
</p>
</div>
<p>Figure @ref(fig:los-dis-plot)<strong>A</strong> shows the distribution of the length of stay (LOS) with a red line marking the median LOS (<strong>5.6</strong> days) and Figure @ref(fig:los-dis-plot)<strong>B</strong> shows the distribution of LOS by diagnosis. Furthermore, Table @ref(tab:los-stat-tab) shows various statistics of the LOS by diagnosis. Encounters with either a missing admission or discharge date have been excluded.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">plot_histogram</span><span class="op">(</span><span class="va">primary_enc</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">LOS</span><span class="op">)</span><span class="op">)</span>,<span class="st">"LOS"</span>,<span class="st">"Distribution of LOS"</span>,<span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">primary_enc</span><span class="op">$</span><span class="va">LOS</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,n_suffix <span class="op">=</span> <span class="st">"encounters"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"LOS (days)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">40</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">250</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">plot_histogram_group</span><span class="op">(</span><span class="va">primary_enc</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">LOS</span><span class="op">)</span><span class="op">)</span>,<span class="st">"LOS"</span>,<span class="st">"PRIMARY_DIAG"</span>,<span class="st">"Distribution of LOS by Diagnosis"</span>,n_suffix <span class="op">=</span> <span class="st">"encounters"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"LOS (days)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">40</span><span class="op">)</span>

<span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">p1</span>,<span class="va">p2</span>,nrow<span class="op">=</span><span class="fl">2</span>,ncol <span class="op">=</span> <span class="fl">1</span>, labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>,<span class="st">"B"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/los-dis-plot-1.png" alt="Distribution of Length of Stay" width="700"><p class="caption">
Distribution of Length of Stay
</p>
</div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">primary_enc</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">primary_enc</span>, PRIMARY_DIAG <span class="op">=</span> <span class="st">"Total"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">LOS</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">PRIMARY_DIAG</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>MEAN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">LOS</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
                   MAX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">LOS</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
                   MIN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">LOS</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
                   MEDIAN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">LOS</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
                   STD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">LOS</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
                   N <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/flextable.html">flextable</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/set_caption.html">set_caption</a></span><span class="op">(</span><span class="st">"Statistics of LOS by HF diagnosis."</span><span class="op">)</span></code></pre></div>
<template id="e050ff07-44d4-4ab7-9c7e-c60348dc3847"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style>
<div class="tabwid">
<style>.cl-300867fe{}.cl-2ffc0bbc{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-2ffc32d6{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-2ffc32d7{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-2ffc8100{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2ffc8101{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2ffc8102{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2ffc8103{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2ffc8104{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2ffc8105{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table class="table cl-300867fe">
<caption class="Table Caption">Statistics of LOS by HF diagnosis.</caption>
<thead><tr style="overflow-wrap:break-word;">
<td class="cl-2ffc8105"><p class="cl-2ffc32d6"><span class="cl-2ffc0bbc">PRIMARY_DIAG</span></p></td>
<td class="cl-2ffc8104"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">MEAN</span></p></td>
<td class="cl-2ffc8104"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">MAX</span></p></td>
<td class="cl-2ffc8104"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">MIN</span></p></td>
<td class="cl-2ffc8104"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">MEDIAN</span></p></td>
<td class="cl-2ffc8104"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">STD</span></p></td>
<td class="cl-2ffc8104"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">N</span></p></td>
</tr></thead>
<tbody>
<tr style="overflow-wrap:break-word;">
<td class="cl-2ffc8101"><p class="cl-2ffc32d6"><span class="cl-2ffc0bbc">Congestive heart failure</span></p></td>
<td class="cl-2ffc8100"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">8.0</span></p></td>
<td class="cl-2ffc8100"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">316.9</span></p></td>
<td class="cl-2ffc8100"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">0.2</span></p></td>
<td class="cl-2ffc8100"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">5.6</span></p></td>
<td class="cl-2ffc8100"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">12.8</span></p></td>
<td class="cl-2ffc8100"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">971</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-2ffc8101"><p class="cl-2ffc32d6"><span class="cl-2ffc0bbc">Heart failure, unspecified</span></p></td>
<td class="cl-2ffc8100"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">6.2</span></p></td>
<td class="cl-2ffc8100"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">30.7</span></p></td>
<td class="cl-2ffc8100"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">0.2</span></p></td>
<td class="cl-2ffc8100"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">4.4</span></p></td>
<td class="cl-2ffc8100"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">6.1</span></p></td>
<td class="cl-2ffc8100"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">42</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-2ffc8101"><p class="cl-2ffc32d6"><span class="cl-2ffc0bbc">Left ventricular failure</span></p></td>
<td class="cl-2ffc8100"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">7.9</span></p></td>
<td class="cl-2ffc8100"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">35.2</span></p></td>
<td class="cl-2ffc8100"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">0.3</span></p></td>
<td class="cl-2ffc8100"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">6.2</span></p></td>
<td class="cl-2ffc8100"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">6.7</span></p></td>
<td class="cl-2ffc8100"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">140</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-2ffc8103"><p class="cl-2ffc32d6"><span class="cl-2ffc0bbc">Total</span></p></td>
<td class="cl-2ffc8102"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">7.9</span></p></td>
<td class="cl-2ffc8102"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">316.9</span></p></td>
<td class="cl-2ffc8102"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">0.2</span></p></td>
<td class="cl-2ffc8102"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">5.6</span></p></td>
<td class="cl-2ffc8102"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">12.1</span></p></td>
<td class="cl-2ffc8102"><p class="cl-2ffc32d7"><span class="cl-2ffc0bbc">1,153</span></p></td>
</tr>
</tbody>
</table>
</div></template><div class="flextable-shadow-host" id="1f26ad78-2eee-4b64-880d-44354367669d"></div>
<script>
var dest = document.getElementById("1f26ad78-2eee-4b64-880d-44354367669d");
var template = document.getElementById("e050ff07-44d4-4ab7-9c7e-c60348dc3847");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script><div id="comparison-with-casemix-app" class="section level2">
<h2 class="hasAnchor">
<a href="#comparison-with-casemix-app" class="anchor"></a>Comparison with CaseMix App</h2>
<p>The above numbers were compared against the in-house <code>Admitted Patient CaseMix app</code> developed by the NSLHD Performance and Analytics team that shows the numbers of encounters and their characteristics of each ICD10 diagnosis.</p>
<p>Figure @ref(fig:clinical-app-demo) shows that there are 1232 encounters with a primary heart failure ICD10 diagnosis over a similar period of time at <code>Royal North Shore</code>. Furthermore the distribution of ICD10 codes are comparable between the current cohort and the NSLHD Performance and Analytics team.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># All defaults</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">"vignettes/img/inpatient_hf_casemix.PNG"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="img/inpatient_hf_casemix.PNG" alt=""><p class="caption">Distribution of ICD10 heart failure encounters using the `Admitted Patient CaseMix App.</p>
</div>
</div>
</div>
<div id="advanced-care-directive" class="section level1">
<h1 class="hasAnchor">
<a href="#advanced-care-directive" class="anchor"></a>Advanced Care Directive</h1>
<p>The Advanced Care Directive is represented in the EMR as an alert with the string <strong>Known to Heart Failure Support Services</strong>.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">known_to_hf</span> <span class="op">&lt;-</span> <span class="va">problem</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">SOURCE_STRING</span>,<span class="st">"(?i)Known to heart failure"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">PERSON_ID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">BEG_EFFECTIVE_DT_TM</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">PERSON_ID</span>,<span class="va">BEG_EFFECTIVE_DT_TM</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>HAS_ALERT <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">kk</span><span class="op">&lt;-</span> <span class="va">primary_cohort</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">.</span>,<span class="fu">select</span><span class="op">(</span><span class="va">known_to_hf</span>,<span class="op">-</span><span class="va">BEG_EFFECTIVE_DT_TM</span><span class="op">)</span> , by<span class="op">=</span><span class="st">"PERSON_ID"</span>,all<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">prop_tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/prop.table.html">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">kk</span><span class="op">$</span><span class="va">HAS_PRIMARY_HF</span>,<span class="va">kk</span><span class="op">$</span><span class="va">HAS_ALERT</span><span class="op">)</span><span class="op">)</span>
<span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">kk</span><span class="op">$</span><span class="va">HAS_PRIMARY_HF</span>,<span class="va">kk</span><span class="op">$</span><span class="va">HAS_ALERT</span><span class="op">)</span>
<span class="va">tab</span>  <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Contigency table of Primary HF ICD10 and Advanced Care directive (ACD)."</span>,digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/add_header_above.html">add_header_above</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Has Primary\n ICD10"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"Has ACD"</span><span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"center"</span>,full_width <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<table class="table table">
<caption>
Contigency table of Primary HF ICD10 and Advanced Care directive (ACD).
</caption>
<thead>
<tr>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="1">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Has Primary<br> ICD10
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Has ACD
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
FALSE
</th>
<th style="text-align:right;">
TRUE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
936
</td>
</tr>
<tr>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:right;">
491
</td>
<td style="text-align:right;">
461
</td>
</tr>
</tbody>
</table>
<p>Table @ref(tab:acd-tab) shows a contingency table of the number of patients with a primary ICD10 code who also have an Advanced Care Directive. The right-most column shows number of patients with a ACD (n = <strong>1397</strong>) and the bottom-most row shows the number of people with a primary HF diagnosis (n = <strong>952</strong>). The combination of the rows and columns show the number of people who have either a ACD or diagnosis, or both or none.</p>
<p>For example, there are <strong>461</strong> patients with both a ACD <strong>AND</strong> a primary heart failure diagnosis. Thus there are <strong>48.4</strong>% of patients (<strong>461/491 + 461</strong>) with a primary HF ICD10 that have an advanced care directive.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">primary_enc_alert</span> <span class="op">&lt;-</span> <span class="va">primary_enc</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">known_to_hf</span>,by<span class="op">=</span><span class="st">"PERSON_ID"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ALERT_DELTA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span><span class="op">(</span><span class="va">BEG_EFFECTIVE_DT_TM</span>,<span class="va">ARRIVE_DT_TM</span>,units<span class="op">=</span><span class="st">"days"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">ALERT_DELTA</span><span class="op">)</span><span class="op">)</span>

<span class="fu">plot_histogram</span><span class="op">(</span>
  <span class="va">primary_enc_alert</span>,
  <span class="st">"ALERT_DELTA"</span>,<span class="st">"Time taken for ACD to be registered since arrival"</span>,
  <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">primary_enc_alert</span><span class="op">$</span><span class="va">ALERT_DELTA</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,n_suffix <span class="op">=</span> <span class="st">"encounters"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">200</span>,<span class="fl">200</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Time (days)"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/alert-delta-plot-1.png" alt="Distribution of time taken to register Advanced Care Directive since admission for the encounter." width="700"><p class="caption">
Distribution of time taken to register Advanced Care Directive since admission for the encounter.
</p>
</div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n_1_alert</span> <span class="op">&lt;-</span> <span class="va">primary_enc_alert</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ALERT_DELTA</span> <span class="op">&lt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">n_3_alert</span> <span class="op">&lt;-</span> <span class="va">primary_enc_alert</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ALERT_DELTA</span> <span class="op">&lt;</span> <span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">n_alert</span> <span class="op">&lt;-</span> <span class="va">primary_enc_alert</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">HAS_ALERT</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">median</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">primary_enc_alert</span><span class="op">$</span><span class="va">ALERT_DELTA</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Figure @ref(fig:alert-delta-plot) shows the distribution of the time taken for the ACD to be registered in the EMR since admission with the median of <strong>2.3</strong> days being marked by the red dashed line. Time differences that are less than 0 means that the ACD was already present when that person was admitted. The data shows that <strong>34</strong>% of alerts are registered within 1 day of admission and <strong>57.2</strong>% within 3 days of admission.</p>
</div>
<div id="historical-diagnosis" class="section level1">
<h1 class="hasAnchor">
<a href="#historical-diagnosis" class="anchor"></a>Historical Diagnosis</h1>
<p>A historical diagnosis for a patient is defined as a HF ICD10 diagnosis (either primary or secondary) that was coded within the last three years of the patientâ€™s first HF diagnosis between <strong>2019</strong> to <strong>2021</strong>. For example, if a patient had been diagnosed with HF in 2018 and 2020, that patient would have been considered to have a historical HF diagnosis if they were diagnosed between 2015 and their encounter in 2018.</p>
<p>Figure @ref(fig:his-diag-plot) shows whether or not a patient has has a historical diagnosis of HF and if so, the coded HF diagnosis. The plot demonstrates that most patients have had no previous HF diagnosis since entering the cohort.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">his_hf_diag</span> <span class="op">&lt;-</span> <span class="va">diagnosis_history</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">SOURCE_IDENTIFIER</span>,<span class="st">"(?i)I50"</span><span class="op">)</span> <span class="op">&amp;</span>
                  <span class="va">PERSON_ID</span> <span class="op">%in%</span> <span class="va">primary_cohort</span><span class="op">$</span><span class="va">PERSON_ID</span><span class="op">)</span>

<span class="va">summary_his_diag</span> <span class="op">&lt;-</span> <span class="va">his_hf_diag</span> <span class="op">%&gt;%</span>
  <span class="fu">extract_hf_diagnosis</span><span class="op">(</span>group_cols <span class="op">=</span> <span class="st">"PERSON_ID"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span><span class="va">primary_cohort</span>,by<span class="op">=</span><span class="st">"PERSON_ID"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">HAS_PRIMARY_HF</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>,<span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>`No His. HF ICD10` <span class="op">=</span> <span class="op">!</span><span class="va">`Congestive heart failure`</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">`Heart failure, unspecified`</span>
                  <span class="op">&amp;</span> <span class="op">!</span><span class="va">`Left ventricular failure`</span><span class="op">)</span>
<span class="fu">plot_logical_columns</span><span class="op">(</span><span class="va">summary_his_diag</span>,<span class="st">"ICD10"</span>,<span class="st">"Distribution of Historical ICD10"</span>,n_suffix<span class="op">=</span><span class="st">"patients"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/his-diag-plot-1.png" alt="Distribution of historical diagnosis." width="700"><p class="caption">
Distribution of historical diagnosis.
</p>
</div>
</div>
<div id="orders" class="section level1">
<h1 class="hasAnchor">
<a href="#orders" class="anchor"></a>Orders</h1>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">echos</span> <span class="op">&lt;-</span> <span class="va">orders</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">CATALOG_CD</span>,<span class="st">"(?i)cardio - echo"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">ENCNTR_ID</span> <span class="op">%in%</span> <span class="va">primary_enc</span><span class="op">$</span><span class="va">ENCNTR_ID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ENCNTR_ID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">STATUS_DT_TM</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ENCNTR_ID</span>,<span class="va">CATALOG_CD</span>,<span class="va">STATUS_DT_TM</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">primary_enc</span>,<span class="va">ENCNTR_ID</span>,<span class="va">ARRIVE_DT_TM</span><span class="op">)</span>,by<span class="op">=</span><span class="st">"ENCNTR_ID"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>HAS_ECHO <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">CATALOG_CD</span><span class="op">)</span>,ECHO_DELTA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span><span class="op">(</span><span class="va">STATUS_DT_TM</span>,<span class="va">ARRIVE_DT_TM</span>,units <span class="op">=</span> <span class="st">"days"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">CATALOG_CD</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>ECHO_START_DT_TM <span class="op">=</span> <span class="va">STATUS_DT_TM</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">extract_path_result</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>,<span class="va">regex</span>,<span class="va">prefix</span>,<span class="va">breaks</span><span class="op">=</span><span class="cn">NULL</span>,<span class="va">labels</span><span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">{</span>
  <span class="va">df</span> <span class="op">%&lt;&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">EVENT_CD</span>,<span class="va">regex</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ENCNTR_ID</span>,<span class="va">EVENT_START_DT_TM</span>,<span class="va">RESULT_VAL</span>,<span class="va">RESULT_UNITS_CD</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>RESULT_VAL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">RESULT_VAL</span>, <span class="st">'\"'</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span>  <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"{prefix}_EVENT_START_DT_TM"</span> <span class="op">:=</span> <span class="va">EVENT_START_DT_TM</span>,
                
                <span class="st">"{prefix}_RESULT_UNITS_CD"</span> <span class="op">:=</span> <span class="va">RESULT_UNITS_CD</span><span class="op">)</span>
  
  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">breaks</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">df</span> <span class="op">%&lt;&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="st">"{prefix}_BIN"</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">RESULT_VAL</span>,breaks<span class="op">=</span><span class="va">breaks</span>,labels<span class="op">=</span><span class="va">labels</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">df</span> <span class="op">%&lt;&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"{prefix}_RESULT_VAL"</span> <span class="op">:=</span> <span class="va">RESULT_VAL</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">path_tests</span> <span class="op">&lt;-</span> <span class="fu">execute_query</span><span class="op">(</span><span class="st">"SELECT * from PATHOLOGY_EVENT where CATALOG_CD = 'Brain Natriuretic Peptide' or CATALOG_CD = 'Iron Level' or CATALOG_CD = 'Iron Studies' or CATALOG_CD = 'N Terminal Pro Brain Natriuretic Peptide'"</span><span class="op">)</span>

<span class="va">path_tests</span> <span class="op">%&lt;&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ENCNTR_ID</span> <span class="op">%in%</span> <span class="va">primary_enc</span><span class="op">$</span><span class="va">ENCNTR_ID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>EVENT_CD <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>
    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">EVENT_CD</span>,<span class="st">"(Brain Natriuretic peptide)|(N Terminal pro BNP)|(NT-ProBNP)"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"BNP"</span>,
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">EVENT_CD</span>
  <span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ENCNTR_ID</span>,<span class="va">EVENT_CD</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">EVENT_START_DT_TM</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hf_order</span><span class="op">&lt;-</span><span class="va">echos</span>  <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span>
    <span class="fu">extract_path_result</span><span class="op">(</span><span class="va">path_tests</span>,<span class="st">"BNP"</span>, <span class="st">"BNP"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>,<span class="fl">450</span>,<span class="fl">900</span>,<span class="cn">Inf</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt; 450"</span>,<span class="st">"450-900"</span>,<span class="st">"900+"</span><span class="op">)</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"ENCNTR_ID"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span>
    <span class="fu">extract_path_result</span><span class="op">(</span><span class="va">path_tests</span>,<span class="st">"Iron"</span>, <span class="st">"IRON"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>,<span class="fl">9</span>,<span class="fl">30.4</span>,<span class="cn">Inf</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt; 9"</span>,<span class="st">"9-30.4"</span>,<span class="st">"30.4+"</span><span class="op">)</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"ENCNTR_ID"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span>
    <span class="fu">extract_path_result</span><span class="op">(</span><span class="va">path_tests</span>,<span class="st">"Transferrin Saturation"</span>, <span class="st">"TRANSFERRIN_SAT"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>,<span class="fl">20</span>,<span class="cn">Inf</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt; 20"</span>,<span class="st">"20+"</span><span class="op">)</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"ENCNTR_ID"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>HAS_BNP <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">BNP_EVENT_START_DT_TM</span><span class="op">)</span>,
                HAS_IRON <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">IRON_EVENT_START_DT_TM</span><span class="op">)</span>,
                HAS_TRANSFERRIN_SAT <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">TRANSFERRIN_SAT_EVENT_START_DT_TM</span><span class="op">)</span><span class="op">)</span>

<span class="fu">plot_logical_columns</span><span class="op">(</span><span class="va">hf_order</span>,<span class="st">"ORDERS"</span>,<span class="st">"Proportion of Encounters with Order"</span>,n_suffix<span class="op">=</span><span class="st">"encounters"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/order-prop-plot-1.png" alt="Number and proportion of Encounters with a relevant heart failure order, echocardiogram, brain natriuretic peptide test, serum iron test and transferrin saturation test." width="700"><p class="caption">
Number and proportion of Encounters with a relevant heart failure order, echocardiogram, brain natriuretic peptide test, serum iron test and transferrin saturation test.
</p>
</div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mean_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">hf_order</span><span class="op">$</span><span class="va">ECHO_DELTA</span>,na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu">plot_histogram</span><span class="op">(</span><span class="va">hf_order</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ECHO_DELTA</span> <span class="op">&lt;</span> <span class="fl">75</span><span class="op">)</span>,
               <span class="st">"ECHO_DELTA"</span>,<span class="st">"Distribution of time taken for Echo"</span>,
               <span class="va">mean_delta</span>,n_suffix<span class="op">=</span><span class="st">"encounters"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Time take for echo since admission (days)"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/echo-time-plot-1.png" alt="Distribution of the time taken for an echocardiogram." width="700"><p class="caption">
Distribution of the time taken for an echocardiogram.
</p>
</div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">orders</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">CATALOG_CD</span>,<span class="st">"(?i)cardio - echo"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">ENCNTR_ID</span> <span class="op">%in%</span> <span class="va">primary_enc</span><span class="op">$</span><span class="va">ENCNTR_ID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">CATALOG_CD</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/flextable.html">flextable</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/autofit.html">autofit</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/set_caption.html">set_caption</a></span><span class="op">(</span><span class="st">"List of strings containing the term 'cardio - echo' and number of occurences."</span><span class="op">)</span></code></pre></div>
<template id="2d66b7e1-7ca0-40ac-80b4-da6d65e3402b"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style>
<div class="tabwid">
<style>.cl-3261cc16{}.cl-32585618{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-32587d1e{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-32587d1f{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-3258cb3e{width:218pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3258cb3f{width:38.9pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3258cb40{width:218pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3258cb41{width:38.9pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3258cb42{width:218pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3258cb43{width:38.9pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table class="table cl-3261cc16">
<caption class="Table Caption">List of strings containing the term 'cardio - echo' and number of occurences.</caption>
<thead><tr style="overflow-wrap:break-word;">
<td class="cl-3258cb42"><p class="cl-32587d1e"><span class="cl-32585618">CATALOG_CD</span></p></td>
<td class="cl-3258cb43"><p class="cl-32587d1f"><span class="cl-32585618">N</span></p></td>
</tr></thead>
<tbody>
<tr style="overflow-wrap:break-word;">
<td class="cl-3258cb3e"><p class="cl-32587d1e"><span class="cl-32585618">Cardio - Echo (LV &amp; RV Function, CCF)</span></p></td>
<td class="cl-3258cb3f"><p class="cl-32587d1f"><span class="cl-32585618">881</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-3258cb40"><p class="cl-32587d1e"><span class="cl-32585618">Cardio - Echo (Valve,Stroke/TIA, Pericar</span></p></td>
<td class="cl-3258cb41"><p class="cl-32587d1f"><span class="cl-32585618">58</span></p></td>
</tr>
</tbody>
</table>
</div></template><div class="flextable-shadow-host" id="70e11c5c-694e-4ce9-95e6-1050c7bb1c26"></div>
<script>
var dest = document.getElementById("70e11c5c-694e-4ce9-95e6-1050c7bb1c26");
var template = document.getElementById("2d66b7e1-7ca0-40ac-80b4-da6d65e3402b");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script><p>Table @ref(tab:echo-string-tab) shows a list of orders in the EMR containing the term <code>cardio- echo</code>.</p>
<p>Figure @ref(fig:order-prop-plot) shows the proportion of encounters with a relevant heart failure order being echocardiogram, brain natriuretic peptide test, serum iron test and transferrin saturation test. Furthermore Figure @ref(fig:echo-time-plot) shows the distribution of the time taken for an echocardiogram with a median time of <strong>2.2</strong> days.</p>
</div>
<div id="forms" class="section level1">
<h1 class="hasAnchor">
<a href="#forms" class="anchor"></a>Forms</h1>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">extract_form</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>,<span class="va">string</span>,<span class="va">prefix</span><span class="op">)</span><span class="op">{</span>
  <span class="va">df</span> <span class="op">%&lt;&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">DESCRIPTION</span> <span class="op">==</span> <span class="va">string</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>HAS_FORM <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">PERSON_ID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">FORM_DT_TM</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">PERSON_ID</span>,<span class="va">ENCNTR_ID</span>,<span class="va">HAS_FORM</span>,<span class="va">PARENT_ENTITY_ID</span>,<span class="va">FORM_DT_TM</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with</a></span><span class="op">(</span>.fn <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>,<span class="st">"_"</span>,<span class="va">.x</span><span class="op">)</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">form_primary_cohort</span> <span class="op">&lt;-</span> <span class="va">primary_cohort</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span>
    <span class="fu">extract_form</span><span class="op">(</span><span class="va">hf_form</span>,<span class="st">'Heart Failure - Management of Cardiac Function Enrolment'</span>,<span class="st">"ENROLMENT"</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PERSON_ID"</span> <span class="op">=</span> <span class="st">"ENROLMENT_PERSON_ID"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span>
    <span class="fu">extract_form</span><span class="op">(</span><span class="va">hf_form</span>,<span class="st">'Heart Failure (MACARF) Referral Form'</span>,<span class="st">"REFERRAL"</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PERSON_ID"</span> <span class="op">=</span> <span class="st">"REFERRAL_PERSON_ID"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ENROLMENT_HAS_FORM <span class="op">=</span> <span class="cn">FALSE</span>, REFERRAL_HAS_FORM <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>NO_FORM <span class="op">=</span> <span class="op">!</span><span class="va">ENROLMENT_HAS_FORM</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">REFERRAL_HAS_FORM</span><span class="op">)</span>

<span class="va">form_primary_cohort</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">HAS_PRIMARY_HF</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">plot_logical_columns</span><span class="op">(</span><span class="st">"Form"</span>,<span class="st">"Proportion with HF Form"</span>,n_suffix<span class="op">=</span><span class="st">"patients"</span><span class="op">)</span> <span class="op">+</span>
 <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">""</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/form-plot-1.png" alt="Proportion of Patients with an enrolment or referral form." width="700"><p class="caption">
Proportion of Patients with an enrolment or referral form.
</p>
</div>
<p>Figure @ref(fig:form-plot) shows the proportion of patients who have had a referral form or enrolment form completed in the EMR.</p>
<p>Figure @ref(fig:no-form-disch-plot) shows the discharge modes for patients without either a referral nor an enrolment form (n = <strong>420</strong>).</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">form_primary_cohort</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">NO_FORM</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">primary_enc</span>,by<span class="op">=</span><span class="st">"PERSON_ID"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">PERSON_ID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>
    DISCH_MODE <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">DISCH_DISPOSITION_CD</span> <span class="op">==</span> <span class="st">'Pt Death without Autopsy'</span><span class="op">)</span> <span class="op">~</span> <span class="st">'Death without Autopsy'</span>,
      <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">DISCH_DISPOSITION_CD</span> <span class="op">==</span> <span class="st">'Discharge Own Risk'</span><span class="op">)</span> <span class="op">~</span> <span class="st">'Discharge Own Risk'</span>,
      <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">DISCH_DISPOSITION_CD</span>, <span class="st">"(?i)transfer"</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="st">'Transfer'</span>,
      <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">DISCH_DISPOSITION_CD</span> <span class="op">==</span> <span class="st">"Discharge by Hospital"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Discharge by Hospital"</span>,
    <span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">proportion_bar_plot</span><span class="op">(</span><span class="st">"DISCH_MODE"</span>,<span class="st">"Discharge mode for patients without forms"</span>,n_suffix<span class="op">=</span><span class="st">"patients"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/no-form-disch-plot-1.png" alt="Distribution of mode of discharge for patients without either a referral nor enrolment form." width="700"><p class="caption">
Distribution of mode of discharge for patients without either a referral nor enrolment form.
</p>
</div>
</div>
<div id="appendix" class="section level1">
<h1 class="hasAnchor">
<a href="#appendix" class="anchor"></a>Appendix</h1>
<div id="medication-for-primary-hf-diagnosis" class="section level2">
<h2 class="hasAnchor">
<a href="#medication-for-primary-hf-diagnosis" class="anchor"></a>Medication for Primary HF Diagnosis</h2>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">primary_meds</span> <span class="op">&lt;-</span> <span class="va">medication_order</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ENCNTR_ID</span> <span class="op">%in%</span> <span class="va">primary_enc</span><span class="op">$</span><span class="va">ENCNTR_ID</span><span class="op">)</span>
<span class="va">primary_enc_meds</span> <span class="op">&lt;-</span> <span class="va">primary_enc</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>HAS_DISCH_MED <span class="op">=</span> <span class="va">ENCNTR_ID</span> <span class="op">%in%</span> <span class="va">primary_meds</span><span class="op">$</span><span class="va">ENCNTR_ID</span><span class="op">)</span></code></pre></div>
<p>Figure @ref(fig:med-type-plot)<strong>A</strong> show the proportion of medications that were either a home or one that was ordered for discharged. Figure @ref(fig:med-type-plot)<strong>B</strong> shows the proportion of the encounters that were given a discharge medication.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">proportion_bar_plot</span><span class="op">(</span><span class="va">primary_meds</span>,<span class="st">"ORIG_ORD_AS_FLAG"</span>,<span class="st">"Type of discharge medication\n"</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">proportion_bar_plot</span><span class="op">(</span><span class="va">primary_enc_meds</span>,<span class="st">"HAS_DISCH_MED"</span>,<span class="st">"Encounters with Discharge Medications\n"</span><span class="op">)</span>

<span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">p1</span>,<span class="va">p2</span>,ncol<span class="op">=</span><span class="fl">2</span>,nrow<span class="op">=</span><span class="fl">1</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>,<span class="st">"B"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/med-type-plot-1.png" alt="The type of medication whether home or discharge medication." width="700"><p class="caption">
The type of medication whether home or discharge medication.
</p>
</div>
<p>Table @ref(tab:med-class-tab) shows the top 15 medication classes given at discharge or home.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">primary_meds</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">MEDICATION_CLASS</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">PERSON_ID</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">N</span><span class="op">/</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">primary_meds</span><span class="op">$</span><span class="va">PERSON_ID</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/top_n.html">top_n</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Top 15 discharge medication class."</span><span class="op">)</span></code></pre></div>
<table class="table">
<caption>
Top 15 discharge medication class.
</caption>
<thead><tr>
<th style="text-align:left;">
MEDICATION_CLASS
</th>
<th style="text-align:right;">
N
</th>
<th style="text-align:right;">
prop
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
NDF
</td>
<td style="text-align:right;">
812
</td>
<td style="text-align:right;">
93.7
</td>
</tr>
<tr>
<td style="text-align:left;">
beta blockers, cardioselective
</td>
<td style="text-align:right;">
389
</td>
<td style="text-align:right;">
44.9
</td>
</tr>
<tr>
<td style="text-align:left;">
loop diuretics
</td>
<td style="text-align:right;">
358
</td>
<td style="text-align:right;">
41.3
</td>
</tr>
<tr>
<td style="text-align:left;">
HMG-CoA reductase inhibitors (statins)
</td>
<td style="text-align:right;">
301
</td>
<td style="text-align:right;">
34.7
</td>
</tr>
<tr>
<td style="text-align:left;">
factor Xa inhibitors
</td>
<td style="text-align:right;">
238
</td>
<td style="text-align:right;">
27.5
</td>
</tr>
<tr>
<td style="text-align:left;">
vitamins
</td>
<td style="text-align:right;">
208
</td>
<td style="text-align:right;">
24.0
</td>
</tr>
<tr>
<td style="text-align:left;">
proton pump inhibitors
</td>
<td style="text-align:right;">
201
</td>
<td style="text-align:right;">
23.2
</td>
</tr>
<tr>
<td style="text-align:left;">
aldosterone receptor antagonists
</td>
<td style="text-align:right;">
195
</td>
<td style="text-align:right;">
22.5
</td>
</tr>
<tr>
<td style="text-align:left;">
minerals and electrolytes
</td>
<td style="text-align:right;">
193
</td>
<td style="text-align:right;">
22.3
</td>
</tr>
<tr>
<td style="text-align:left;">
angiotensin converting enzyme (ACE) inhibitors
</td>
<td style="text-align:right;">
186
</td>
<td style="text-align:right;">
21.5
</td>
</tr>
<tr>
<td style="text-align:left;">
angiotensin II inhibitors
</td>
<td style="text-align:right;">
137
</td>
<td style="text-align:right;">
15.8
</td>
</tr>
<tr>
<td style="text-align:left;">
coumarins and indanediones
</td>
<td style="text-align:right;">
115
</td>
<td style="text-align:right;">
13.3
</td>
</tr>
<tr>
<td style="text-align:left;">
group III antiarrhythmics
</td>
<td style="text-align:right;">
114
</td>
<td style="text-align:right;">
13.1
</td>
</tr>
<tr>
<td style="text-align:left;">
calcium channel blocking agents
</td>
<td style="text-align:right;">
112
</td>
<td style="text-align:right;">
12.9
</td>
</tr>
<tr>
<td style="text-align:left;">
potassium-sparing diuretics
</td>
<td style="text-align:right;">
107
</td>
<td style="text-align:right;">
12.3
</td>
</tr>
</tbody>
</table>
</div>
<div id="orders-for-cohort-with-primary-hf-diagnosis" class="section level2">
<h2 class="hasAnchor">
<a href="#orders-for-cohort-with-primary-hf-diagnosis" class="anchor"></a>Orders for Cohort with Primary HF Diagnosis</h2>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span><span class="op">&lt;-</span><span class="fu">plot_pie_chart</span><span class="op">(</span><span class="va">hf_order</span>,<span class="st">"BNP_BIN"</span>,<span class="st">"BNP Results by Group"</span><span class="op">)</span>
<span class="va">p2</span><span class="op">&lt;-</span><span class="fu">plot_pie_chart</span><span class="op">(</span><span class="va">hf_order</span>,<span class="st">"IRON_BIN"</span>,<span class="st">"BNP Results by Group"</span><span class="op">)</span>
<span class="va">p3</span><span class="op">&lt;-</span><span class="fu">plot_pie_chart</span><span class="op">(</span><span class="va">hf_order</span>,<span class="st">"TRANSFERRIN_SAT_BIN"</span>,<span class="st">"BNP Results by Group"</span><span class="op">)</span>

<span class="co">#ggpubr::ggarrange(p1,p2,p3,nrow=3,ncol=1,labels=c("A","B","C"))</span>


<span class="va">p1</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/path-test-plot-1.png" alt="Results of pathology tests." width="700"><p class="caption">
Results of pathology tests.
</p>
</div>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p2</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/path-test-plot-2.png" alt="Results of pathology tests." width="700"><p class="caption">
Results of pathology tests.
</p>
</div>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p3</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/path-test-plot-3.png" alt="Results of pathology tests." width="700"><p class="caption">
Results of pathology tests.
</p>
</div>
</div>
<div id="inclusion-of-primary-and-secondary-hf-diagnosis" class="section level2">
<h2 class="hasAnchor">
<a href="#inclusion-of-primary-and-secondary-hf-diagnosis" class="anchor"></a>Inclusion of Primary and Secondary HF Diagnosis</h2>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">primary_cohort</span> <span class="op">&lt;-</span> <span class="va">cohort</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">PERSON_ID</span> <span class="op">%in%</span> <span class="va">qual_enc</span><span class="op">$</span><span class="va">PERSON_ID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>HAS_PRIMARY_HF <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>


<span class="va">AGE_breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>,<span class="fl">18</span>, <span class="fl">25</span>, <span class="fl">45</span>, <span class="fl">65</span>, <span class="fl">80</span>, <span class="cn">Inf</span><span class="op">)</span>
  <span class="va">AGE_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;18"</span>, <span class="st">"19-24"</span>, <span class="st">"25-44"</span>, <span class="st">"45-64"</span>, <span class="st">"65-80"</span>, <span class="st">"80+"</span><span class="op">)</span>
  
<span class="va">primary_enc</span> <span class="op">&lt;-</span> <span class="va">qual_enc</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">patient</span>, by <span class="op">=</span> <span class="st">"PERSON_ID"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>AGE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span><span class="op">(</span><span class="va">ACTIVE_STATUS_DT_TM</span>,<span class="va">BIRTH_DT_TM</span>, units<span class="op">=</span><span class="st">"weeks"</span><span class="op">)</span><span class="op">/</span><span class="fl">52.25</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>AGE_BINNED <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">AGE</span>, breaks <span class="op">=</span> <span class="va">AGE_breaks</span>, labels <span class="op">=</span> <span class="va">AGE_labels</span>,
                                   right <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>LOS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span><span class="op">(</span><span class="va">DISCH_DT_TM</span>,<span class="va">ARRIVE_DT_TM</span>,units<span class="op">=</span><span class="st">"days"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">total</span><span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">primary_enc</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">primary_enc</span>, SEX_CD <span class="op">=</span> <span class="st">"Total"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">SEX_CD</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>
    N <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,
    Age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">AGE</span><span class="op">)</span><span class="op">)</span>,
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"SEX_CD"</span>, values_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"N"</span>, <span class="st">"Age"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>p_Female <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">N_Female</span><span class="op">/</span><span class="va">N_Total</span><span class="op">*</span><span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>,
         p_Male <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">N_Male</span><span class="op">/</span><span class="va">N_Total</span><span class="op">*</span><span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span>
         Females <span class="op">=</span> <span class="va">N_Female</span>, <span class="va">p_Female</span>,
         Males <span class="op">=</span> <span class="va">N_Male</span>, <span class="va">p_Male</span>,
         <span class="va">N_Total</span>,
         <span class="va">Age_Female</span>,
         <span class="va">Age_Male</span>,
         <span class="va">Age_Total</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/flextable.html">flextable</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/set_header_labels.html">set_header_labels</a></span><span class="op">(</span>Group <span class="op">=</span> <span class="st">""</span>, p_Female <span class="op">=</span> <span class="st">"%"</span>, p_Male <span class="op">=</span> <span class="st">"%"</span>, N_Total <span class="op">=</span> <span class="st">"n"</span>,
                    Age_Female <span class="op">=</span> <span class="st">"Age (F)"</span>, Age_Male <span class="op">=</span> <span class="st">"Age (M)"</span>, Age_Total <span class="op">=</span> <span class="st">"Mean Age"</span><span class="op">)</span>
<span class="va">total</span></code></pre></div>
<template id="2ddadd96-caf5-4bcd-803a-88baced4ad52"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style>
<div class="tabwid">
<style>.cl-352390ec{}.cl-351a900a{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-351ab710{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-351ade20{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-351ade21{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table class="table cl-352390ec">
<thead><tr style="overflow-wrap:break-word;">
<td class="cl-351ade21"><p class="cl-351ab710"><span class="cl-351a900a">Females</span></p></td>
<td class="cl-351ade21"><p class="cl-351ab710"><span class="cl-351a900a">%</span></p></td>
<td class="cl-351ade21"><p class="cl-351ab710"><span class="cl-351a900a">Males</span></p></td>
<td class="cl-351ade21"><p class="cl-351ab710"><span class="cl-351a900a">%</span></p></td>
<td class="cl-351ade21"><p class="cl-351ab710"><span class="cl-351a900a">n</span></p></td>
<td class="cl-351ade21"><p class="cl-351ab710"><span class="cl-351a900a">Age (F)</span></p></td>
<td class="cl-351ade21"><p class="cl-351ab710"><span class="cl-351a900a">Age (M)</span></p></td>
<td class="cl-351ade21"><p class="cl-351ab710"><span class="cl-351a900a">Mean Age</span></p></td>
</tr></thead>
<tbody><tr style="overflow-wrap:break-word;">
<td class="cl-351ade20"><p class="cl-351ab710"><span class="cl-351a900a">1,597</span></p></td>
<td class="cl-351ade20"><p class="cl-351ab710"><span class="cl-351a900a">45.1</span></p></td>
<td class="cl-351ade20"><p class="cl-351ab710"><span class="cl-351a900a">1,941</span></p></td>
<td class="cl-351ade20"><p class="cl-351ab710"><span class="cl-351a900a">54.9</span></p></td>
<td class="cl-351ade20"><p class="cl-351ab710"><span class="cl-351a900a">3,538</span></p></td>
<td class="cl-351ade20"><p class="cl-351ab710"><span class="cl-351a900a">81</span></p></td>
<td class="cl-351ade20"><p class="cl-351ab710"><span class="cl-351a900a">78</span></p></td>
<td class="cl-351ade20"><p class="cl-351ab710"><span class="cl-351a900a">79</span></p></td>
</tr></tbody>
</table>
</div></template><div class="flextable-shadow-host" id="16b12279-973f-45bc-9430-2a1310ee2696"></div>
<script>
var dest = document.getElementById("16b12279-973f-45bc-9430-2a1310ee2696");
var template = document.getElementById("2ddadd96-caf5-4bcd-803a-88baced4ad52");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script><p>Figure @ref(fig:age-sex-plot-sec) shows the distribution of sex according to age groups.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">conditional_bar_plot</span><span class="op">(</span><span class="va">primary_enc</span>,<span class="st">"AGE_BINNED"</span>,<span class="st">"SEX_CD"</span>, <span class="st">"Age and Sex"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html">scale_fill_discrete</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"SEX"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"AGE"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/age-sex-plot-sec-1.png" alt="Distribution of Sex conditioned on Age." width="700"><p class="caption">
Distribution of Sex conditioned on Age.
</p>
</div>
<p>Figure @ref(fig:los-dis-plot-sec) shows the distribution of the length of stay (LOS) marked with the average LOS (<strong>10.3</strong> days). Encounters with either a missing admission or discharge date have been excluded.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">plot_histogram</span><span class="op">(</span><span class="va">primary_enc</span>,<span class="st">"LOS"</span>,<span class="st">"Distribution of LOS"</span>,<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">primary_enc</span><span class="op">$</span><span class="va">LOS</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"LOS (days)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">50</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/los-dis-plot-sec-1.png" alt="Distribution of Length of Stay" width="700"><p class="caption">
Distribution of Length of Stay
</p>
</div>
<p>Figure @ref(fig:encntr-type-plot-sec) shows the distribution of encounters types.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">proportion_bar_plot</span><span class="op">(</span><span class="va">primary_enc</span>,<span class="st">"ENCNTR_TYPE_CD"</span>,<span class="st">"Distribution of Encounter Type."</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/encntr-type-plot-sec-1.png" alt="Distribution of Encounter Type." width="700"><p class="caption">
Distribution of Encounter Type.
</p>
</div>
<div id="advanced-care-directive-1" class="section level3">
<h3 class="hasAnchor">
<a href="#advanced-care-directive-1" class="anchor"></a>Advanced Care Directive</h3>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">known_to_hf</span> <span class="op">&lt;-</span> <span class="va">problem</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">SOURCE_STRING</span>,<span class="st">"(?i)Known to heart failure"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">PERSON_ID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>HAS_ALERT <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">kk</span><span class="op">&lt;-</span> <span class="va">primary_cohort</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">.</span>,<span class="va">known_to_hf</span> , by<span class="op">=</span><span class="st">"PERSON_ID"</span>,all<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">prop_tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/prop.table.html">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">kk</span><span class="op">$</span><span class="va">HAS_PRIMARY_HF</span>,<span class="va">kk</span><span class="op">$</span><span class="va">HAS_ALERT</span><span class="op">)</span><span class="op">)</span>
<span class="va">prop_tab</span> <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Contigency table of Primary HF ICD10 and Advanced Care directive (ACD)."</span>,digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/add_header_above.html">add_header_above</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Has Primary\n ICD10"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"Has ACD"</span><span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"center"</span>,full_width <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<table class="table table">
<caption>
Contigency table of Primary HF ICD10 and Advanced Care directive (ACD).
</caption>
<thead>
<tr>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="1">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Has Primary<br> ICD10
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Has ACD
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
FALSE
</th>
<th style="text-align:right;">
TRUE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.19
</td>
</tr>
<tr>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:right;">
0.57
</td>
<td style="text-align:right;">
0.24
</td>
</tr>
</tbody>
</table>
<p>Table @ref(tab:acd-tab-sec) shows a contingency table of the number of patients with a primary ICD10 code who also have an Advanced Care Directive. <strong>70.1</strong>% of patients with a primary HF ICD10 have an advanced care directive. Table xxx shows the cohort with either a primary or secondary HF diagnosis.</p>
</div>
<div id="historical-diagnosis-1" class="section level3">
<h3 class="hasAnchor">
<a href="#historical-diagnosis-1" class="anchor"></a>Historical Diagnosis</h3>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">his_hf_diag</span> <span class="op">&lt;-</span> <span class="va">diagnosis_history</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">SOURCE_IDENTIFIER</span>,<span class="st">"(?i)I50"</span><span class="op">)</span> <span class="op">&amp;</span>
                  <span class="va">PERSON_ID</span> <span class="op">%in%</span> <span class="va">primary_cohort</span><span class="op">$</span><span class="va">PERSON_ID</span><span class="op">)</span>

<span class="va">summary_his_diag</span> <span class="op">&lt;-</span> <span class="va">his_hf_diag</span> <span class="op">%&gt;%</span>
  <span class="fu">extract_hf_diagnosis</span><span class="op">(</span>group_cols <span class="op">=</span> <span class="st">"PERSON_ID"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span><span class="va">primary_cohort</span>,by<span class="op">=</span><span class="st">"PERSON_ID"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">HAS_PRIMARY_HF</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>,<span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>`No His. HF ICD10` <span class="op">=</span> <span class="op">!</span><span class="va">`Congestive heart failure`</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">`Heart failure, unspecified`</span>
                  <span class="op">&amp;</span> <span class="op">!</span><span class="va">`Left ventricular failure`</span><span class="op">)</span>
<span class="fu">plot_logical_columns</span><span class="op">(</span><span class="va">summary_his_diag</span>,<span class="st">"ICD10"</span>,<span class="st">"Distribution of Historical ICD10"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/his-diag-plot-sec-1.png" alt="Distribution of historical diagnosis." width="700"><p class="caption">
Distribution of historical diagnosis.
</p>
</div>
</div>
<div id="orders-1" class="section level3">
<h3 class="hasAnchor">
<a href="#orders-1" class="anchor"></a>Orders</h3>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">echos</span> <span class="op">&lt;-</span> <span class="va">orders</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">CATALOG_CD</span>,<span class="st">"(?i)cardio - echo"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">ENCNTR_ID</span> <span class="op">%in%</span> <span class="va">primary_enc</span><span class="op">$</span><span class="va">ENCNTR_ID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ENCNTR_ID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">STATUS_DT_TM</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ENCNTR_ID</span>,<span class="va">CATALOG_CD</span>,<span class="va">STATUS_DT_TM</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">primary_enc</span>,<span class="va">ENCNTR_ID</span>,<span class="va">ARRIVE_DT_TM</span><span class="op">)</span>,by<span class="op">=</span><span class="st">"ENCNTR_ID"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>HAS_ECHO <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">CATALOG_CD</span><span class="op">)</span>,ECHO_DELTA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span><span class="op">(</span><span class="va">STATUS_DT_TM</span>,<span class="va">ARRIVE_DT_TM</span>,units <span class="op">=</span> <span class="st">"days"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">CATALOG_CD</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>ECHO_START_DT_TM <span class="op">=</span> <span class="va">STATUS_DT_TM</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">path_tests</span> <span class="op">&lt;-</span> <span class="fu">execute_query</span><span class="op">(</span><span class="st">"SELECT * from PATHOLOGY_EVENT where CATALOG_CD = 'Brain Natriuretic Peptide' or CATALOG_CD = 'Iron Level' or CATALOG_CD = 'Iron Studies' or CATALOG_CD = 'N Terminal Pro Brain Natriuretic Peptide'"</span><span class="op">)</span>

<span class="va">path_tests</span> <span class="op">%&lt;&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ENCNTR_ID</span> <span class="op">%in%</span> <span class="va">primary_enc</span><span class="op">$</span><span class="va">ENCNTR_ID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>EVENT_CD <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>
    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">EVENT_CD</span>,<span class="st">"(Brain Natriuretic peptide)|(N Terminal pro BNP)|(NT-ProBNP)"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"BNP"</span>,
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">EVENT_CD</span>
  <span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ENCNTR_ID</span>,<span class="va">EVENT_CD</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">EVENT_START_DT_TM</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hf_order</span><span class="op">&lt;-</span><span class="va">echos</span>  <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span>
    <span class="fu">extract_path_result</span><span class="op">(</span><span class="va">path_tests</span>,<span class="st">"BNP"</span>, <span class="st">"BNP"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>,<span class="fl">450</span>,<span class="fl">900</span>,<span class="cn">Inf</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt; 450"</span>,<span class="st">"450-900"</span>,<span class="st">"900+"</span><span class="op">)</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"ENCNTR_ID"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span>
    <span class="fu">extract_path_result</span><span class="op">(</span><span class="va">path_tests</span>,<span class="st">"Iron"</span>, <span class="st">"IRON"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>,<span class="fl">9</span>,<span class="fl">30.4</span>,<span class="cn">Inf</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt; 9"</span>,<span class="st">"9-30.4"</span>,<span class="st">"30.4+"</span><span class="op">)</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"ENCNTR_ID"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span>
    <span class="fu">extract_path_result</span><span class="op">(</span><span class="va">path_tests</span>,<span class="st">"Transferrin Saturation"</span>, <span class="st">"TRANSFERRIN_SAT"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>,<span class="fl">20</span>,<span class="cn">Inf</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt; 20"</span>,<span class="st">"20+"</span><span class="op">)</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"ENCNTR_ID"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>HAS_BNP <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">BNP_EVENT_START_DT_TM</span><span class="op">)</span>,
                HAS_IRON <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">IRON_EVENT_START_DT_TM</span><span class="op">)</span>,
                HAS_TRANSFERRIN_SAT <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">TRANSFERRIN_SAT_EVENT_START_DT_TM</span><span class="op">)</span><span class="op">)</span>

<span class="fu">plot_logical_columns</span><span class="op">(</span><span class="va">hf_order</span>,<span class="st">"ORDERS"</span>,<span class="st">"Proportion of Encounter with Order"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/order-prop-plot-sec-1.png" alt="Number and proportion of Encounters with a relevant heart failure order, echocardiogram, brain natriuretic peptide test, serum iron test and transferrin saturation test." width="700"><p class="caption">
Number and proportion of Encounters with a relevant heart failure order, echocardiogram, brain natriuretic peptide test, serum iron test and transferrin saturation test.
</p>
</div>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mean_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">hf_order</span><span class="op">$</span><span class="va">ECHO_DELTA</span>,na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu">plot_histogram</span><span class="op">(</span><span class="va">hf_order</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ECHO_DELTA</span> <span class="op">&lt;</span> <span class="fl">75</span><span class="op">)</span>,
               <span class="st">"ECHO_DELTA"</span>,<span class="st">"Distribution of time taken for Echo"</span>,
               <span class="va">mean_delta</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Time take for echo since admission (days)"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/echo-time-plot-sec-1.png" alt="Distribution of the time taken for an echocardiogram." width="700"><p class="caption">
Distribution of the time taken for an echocardiogram.
</p>
</div>
<p>Figure @ref(fig:order-prop-plot) shows the proportion of encounters with a relevant heart failure order being echocardiogram, brain natriuretic peptide test, serum iron test and transferrin saturation test. Furthermore Figure @ref(fig:echo-time-plot) shows the distribution of the time taken for an echocardiogram with a mean time of <strong>5.2</strong> days.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span><span class="op">&lt;-</span><span class="fu">plot_pie_chart</span><span class="op">(</span><span class="va">hf_order</span>,<span class="st">"BNP_BIN"</span>,<span class="st">"BNP Results by Group"</span><span class="op">)</span>
<span class="va">p2</span><span class="op">&lt;-</span><span class="fu">plot_pie_chart</span><span class="op">(</span><span class="va">hf_order</span>,<span class="st">"IRON_BIN"</span>,<span class="st">"BNP Results by Group"</span><span class="op">)</span>
<span class="va">p3</span><span class="op">&lt;-</span><span class="fu">plot_pie_chart</span><span class="op">(</span><span class="va">hf_order</span>,<span class="st">"TRANSFERRIN_SAT_BIN"</span>,<span class="st">"BNP Results by Group"</span><span class="op">)</span>

<span class="co">#ggpubr::ggarrange(p1,p2,p3,nrow=3,ncol=1,labels=c("A","B","C"))</span>


<span class="va">p1</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/path-test-plot-sec-1.png" alt="Results of pathology tests." width="700"><p class="caption">
Results of pathology tests.
</p>
</div>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p2</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/path-test-plot-sec-2.png" alt="Results of pathology tests." width="700"><p class="caption">
Results of pathology tests.
</p>
</div>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p3</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/path-test-plot-sec-3.png" alt="Results of pathology tests." width="700"><p class="caption">
Results of pathology tests.
</p>
</div>
</div>
<div id="forms-1" class="section level3">
<h3 class="hasAnchor">
<a href="#forms-1" class="anchor"></a>Forms</h3>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">form_primary_cohort</span> <span class="op">&lt;-</span> <span class="va">primary_cohort</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span>
    <span class="fu">extract_form</span><span class="op">(</span><span class="va">hf_form</span>,<span class="st">'Heart Failure - Management of Cardiac Function Enrolment'</span>,<span class="st">"ENROLMENT"</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PERSON_ID"</span> <span class="op">=</span> <span class="st">"ENROLMENT_PERSON_ID"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span>
    <span class="fu">extract_form</span><span class="op">(</span><span class="va">hf_form</span>,<span class="st">'Heart Failure (MACARF) Referral Form'</span>,<span class="st">"REFERRAL"</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PERSON_ID"</span> <span class="op">=</span> <span class="st">"REFERRAL_PERSON_ID"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ENROLMENT_HAS_FORM <span class="op">=</span> <span class="cn">FALSE</span>, REFERRAL_HAS_FORM <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>

<span class="fu">plot_logical_columns</span><span class="op">(</span><span class="va">form_primary_cohort</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">HAS_PRIMARY_HF</span><span class="op">)</span>,<span class="st">"Form"</span>,<span class="st">"Proportion with HF Form"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="inpatient_analysis_files/figure-html/form-plot-sec-1.png" alt="Proportion of Patients with an enrolment or referral form." width="700"><p class="caption">
Proportion of Patients with an enrolment or referral form.
</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
